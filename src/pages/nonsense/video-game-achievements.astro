---
//import fs module as es module
import fs from "fs";
import { parse } from "yaml";
import Layout from "../../layouts/Layout.astro";
import { classnames } from "../../lib/classnames";

const yml = fs.readFileSync(
  "src/pages/nonsense/video-game-achievements.yaml",
  "utf8",
);
const parsed = parse(yml);

const parseYmlAchievement = (nameAndNotes) => {
  const [name, notes] = nameAndNotes.split(";;").map((s) => s.trim());
  return [name, notes];
};
const data = parsed.games.map(({ name, achieved = [], missing = [] }) => ({
  game: name,
  achievements: [
    ...achieved
      .map(parseYmlAchievement)
      .map(([name, notes]) => [name, true, notes]),
    ...missing
      .map(parseYmlAchievement)
      .map(([name, notes]) => [name, false, notes]),
  ],
}));
---

<Layout title="Video Game Achievements">
  <h1>Video Game Achievements</h1>
  <p>These are video game achievements I've come up with for myself.</p>
  <div>
    {
      data.map(({ game, achievements }) => {
        const allAchieved = achievements.every(([_, achieved]) => achieved);

        return (
          <>
            <div class="game-label">{game}</div>
            <div
              class={classnames(
                "achievements",
                "dashed-border",
                allAchieved && "gold-border",
              )}
            >
              {achievements.map(([name, achieved, notes, icon]) => (
                <div class={achieved ? "active" : ""}>
                  <div>{achieved ? "🏆" : "🔒 "}</div>
                  <div>
                    <div>{name}</div>
                    {notes && <div class="notes">{notes}</div>}
                  </div>
                </div>
              ))}
            </div>
          </>
        );
      })
    }
  </div>
</Layout>
<style>
  .achievements {
    display: flex;
    flex-direction: column;
    background: rgba(0, 0, 0, 0.4);
    padding: 1rem;
    margin-top: 0.8rem;
    margin-bottom: 2.5rem;
  }
  .achievements > div {
    display: flex;
    margin: 4px 0;
  }
  .achievements > div > div:first-child {
    margin-right: 6px;
  }
  .achievements > div:not(.active) {
    opacity: 0.5;
  }
  .achievements.gold-border {
    border-color: gold;
  }
  .notes {
    opacity: 0.5;
  }
  .game-label {
    font-size: 1.3rem;
    font-weight: bold;
  }
</style>
